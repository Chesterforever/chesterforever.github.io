---
title: STM32H750VBT6学习
date: 2024-08-20 00:23:45
tags: [MCU,STM32H7]
index_img: /img/avatar.png
---

# STM32H750VBT6学习

### 1.Cache（缓存）

Cache是跟Flash和SRAM同一级别的存在，是一种高速小容量存储器，主要作为高速缓冲区

**CPU <-> Cache <-> 主存（DRAM） <-> 外部存储（Flash/HDD）**

Cache带来了性能提升，但也引入了数据一致性问题：

- **DMA操作：** 当DMA控制器（如MDMA, BDMA）直接修改了主存（SRAM）中的数据时，如果这部分数据已经被缓存在CPU的D-Cache中，那么Cache里的数据就是旧的、不一致的。CPU读到的是旧数据。
- **外设寄存器访问：** 外设寄存器通常映射到内存地址（称为内存映射I/O）。如果CPU缓存了某个外设寄存器的值，而外设实际状态已经改变（例如中断标志置位），CPU读到的可能是缓存中的旧值，错过状态变化。

暂时的解决方法：在DMA传输前后或访问关键外设寄存器前后，使用CMSIS或HAL库提供的函数（如`SCB_CleanDCache`, `SCB_InvalidateDCache`, `SCB_CleanInvalidateDCache`）来清理（将Cache数据写回内存）或无效化（丢弃Cache数据，下次从内存读）特定的Cache区域。

进阶解决方法：可以配置MPU将特定的内存区域（如SRAM区域、外设寄存器区域）标记为`Non-cacheable`（不可缓存）或`Write-through`（透写）等属性，让硬件自动处理一致性。**强烈建议在使用DMA或频繁访问外设寄存器的区域配置MPU。**

### 2.MDMA(master DMA)

更强大的DMA，可以直接控制系统总线，可以访问芯片上所有的内存和外设，带宽更高，内核低功耗模式下仍能工作，支持链表传输；**唯一可以访问TCM的外设**

MDMA控制器的工作机制克服了传统DMA控制器固有的“通道瓶颈”问题，它不再依赖于数量有限且可能被独占的物理通道，而是采用了一种基于请求优先级进行动态调度的架构（取消了通道这个概念，但是保留了优先级机制）；

链表传输：普通的DMA只能传输连续的内存区域的数据，MDMA通过硬件自动遍历链表结构实现链表传输，典型应用场景为处理非连续数据时，比如多个Packet Buffer，多帧数据，非连续的磁盘扇区；

提供 5 个事件标志（ MDMA 通道传输完成、 MDMA 块传输完成、 MDMA 块重复传输完成、 MDMA 缓冲区传输完成、 MDMA 传输出错），且这些标志可生成中断。  

### 3.BDMA（basic DMA）

专注于低功耗的DMA，位于低功耗域，在standby模式下仍能使用，功能较少，通道数少，只能访问低功耗域范围的SRAM和外设数据

### 4.FDCAN

CAN升级版，最高速率可达5Mbps，相比于CAN只有8字节的数据场，支持最多64字节的数据场，显著提高有效数据吞吐量，同时支持经典CAN帧格式；

FDCAN帧可以灵活地在仲裁段使用较低速率（保证兼容性和抗干扰性），在数据段切换到高速率（提高传输效率）















